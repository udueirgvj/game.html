<!DOCTYPE html><html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hunter Forest Game</title><style>
body{
margin:0;
overflow:hidden;
background:black;
touch-action:none;
font-family:Arial;
}

#info{
position:absolute;
top:15px;
left:15px;
color:white;
background:rgba(0,0,0,0.5);
padding:8px 14px;
border-radius:20px;
z-index:10;
}

#joystick{
position:absolute;
bottom:40px;
left:40px;
width:150px;
height:150px;
z-index:20;
}
</style></head><body><div id="info">حرّك الشخصية بالجويستك</div>
<div id="joystick"></div><script type="module">

import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js";
import { GLTFLoader } from "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/loaders/GLTFLoader.js";

/* ---------- المشهد ---------- */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xbfd1e5);
scene.fog = new THREE.Fog(0xbfd1e5, 40, 350);

/* ---------- الكاميرا ---------- */
const camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,5000);
camera.position.set(0,5,10);

/* ---------- الرندر ---------- */
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.shadowMap.enabled=true;
document.body.appendChild(renderer.domElement);

/* ---------- الإضاءة ---------- */
const sun=new THREE.DirectionalLight(0xffffff,2);
sun.position.set(100,200,100);
sun.castShadow=true;
scene.add(sun);

scene.add(new THREE.AmbientLight(0xffffff,0.4));

/* ---------- الأرض ---------- */
const ground=new THREE.Mesh(
new THREE.PlaneGeometry(2000,2000),
new THREE.MeshStandardMaterial({color:0x4c8b3b})
);
ground.rotation.x=-Math.PI/2;
ground.receiveShadow=true;
scene.add(ground);

/* ---------- الغابة ---------- */
function createTree(x,z){
const trunk=new THREE.Mesh(
new THREE.CylinderGeometry(0.4,0.5,5,8),
new THREE.MeshStandardMaterial({color:0x5b3a1a})
);
trunk.position.set(x,2.5,z);
trunk.castShadow=true;
scene.add(trunk);

const leaves=new THREE.Mesh(
new THREE.ConeGeometry(2.5,6,8),
new THREE.MeshStandardMaterial({color:0x1f6b2e})
);
leaves.position.set(x,7,z);
leaves.castShadow=true;
scene.add(leaves);
}

for(let i=0;i<350;i++){
let x=(Math.random()-0.5)*800;
let z=(Math.random()-0.5)*800;
createTree(x,z);
}

/* ---------- تحميل الشخصية ---------- */
let player=null;
let mixer=null;

const loader=new GLTFLoader();
loader.load(
"https://threejs.org/examples/models/gltf/Soldier.glb",
function(gltf){

player=gltf.scene;
player.scale.set(2,2,2);

player.traverse(obj=>{
if(obj.isMesh){
obj.castShadow=true;
obj.receiveShadow=true;
}
});

scene.add(player);

mixer=new THREE.AnimationMixer(player);
mixer.clipAction(gltf.animations[0]).play();

}
);

/* ---------- الجويستك ---------- */
let joyX=0;
let joyY=0;
window.joyX=0;
window.joyY=0;

/* ---------- التحديث ---------- */
function updatePlayer(){

if(!player) return;

let speed=0.15;

player.position.x+=window.joyX*speed;
player.position.z-=window.joyY*speed;

if(window.joyX!==0||window.joyY!==0){
player.rotation.y=Math.atan2(window.joyX,window.joyY);
}

const dist=8;
const height=5;

const camX=player.position.x+Math.sin(player.rotation.y)*dist;
const camZ=player.position.z+Math.cos(player.rotation.y)*dist;

camera.position.set(camX,player.position.y+height,camZ);
camera.lookAt(player.position.x,player.position.y+2,player.position.z);

if(mixer) mixer.update(0.016);
}

/* ---------- حلقة اللعبة ---------- */
function animate(){
requestAnimationFrame(animate);
updatePlayer();
renderer.render(scene,camera);
}
animate();

/* ---------- تغيير حجم ---------- */
window.addEventListener("resize",()=>{
camera.aspect=window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
});

</script><script src="https://cdn.jsdelivr.net/npm/nipplejs@0.10.1/dist/nipplejs.min.js"></script><script>
const joystick=nipplejs.create({
zone:document.getElementById('joystick'),
mode:'static',
position:{left:'75px',bottom:'75px'},
color:'white',
size:120
});

joystick.on('move',(evt,data)=>{
if(data.vector){
window.joyX=data.vector.x;
window.joyY=data.vector.y;
}
});

joystick.on('end',()=>{
window.joyX=0;
window.joyY=0;
});
</script></body>
</html>
